apiVersion: cozystack.io/v1alpha1
kind: ApplicationDefinition
metadata:
  name: elasticsearch
spec:
  application:
    kind: Elasticsearch
    singular: elasticsearch
    plural: elasticsearches
    openAPISchema: |-
      {"title":"Chart Values","type":"object","properties":{"external":{"description":"Enable external access from outside the cluster.","type":"boolean","default":false},"images":{"description":"Container images used by the operator.","type":"object","default":{},"required":["elasticsearch"],"properties":{"elasticsearch":{"description":"Elasticsearch image.","type":"string","default":"docker.elastic.co/elasticsearch/elasticsearch:8.17.0"}}},"kibana":{"description":"Kibana configuration.","type":"object","default":{},"required":["enabled","replicas","resourcesPreset"],"properties":{"enabled":{"description":"Enable Kibana deployment.","type":"boolean","default":false},"replicas":{"description":"Number of Kibana replicas.","type":"integer","default":1},"resources":{"description":"Explicit CPU and memory configuration for Kibana.","type":"object","default":{},"properties":{"cpu":{"description":"CPU available to each node.","pattern":"^(\\+|-)?(([0-9]+(\\.[0-9]*)?)|(\\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\\+|-)?(([0-9]+(\\.[0-9]*)?)|(\\.[0-9]+))))?$","anyOf":[{"type":"integer"},{"type":"string"}],"x-kubernetes-int-or-string":true},"memory":{"description":"Memory (RAM) available to each node.","pattern":"^(\\+|-)?(([0-9]+(\\.[0-9]*)?)|(\\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\\+|-)?(([0-9]+(\\.[0-9]*)?)|(\\.[0-9]+))))?$","anyOf":[{"type":"integer"},{"type":"string"}],"x-kubernetes-int-or-string":true}}},"resourcesPreset":{"description":"Default sizing preset for Kibana.","type":"string","default":"medium","enum":["nano","micro","small","medium","large","xlarge","2xlarge"]}}},"nodeRoles":{"description":"Node roles configuration.","type":"object","default":{},"required":["data","ingest","master","ml"],"properties":{"data":{"description":"Enable data role.","type":"boolean","default":true},"ingest":{"description":"Enable ingest role.","type":"boolean","default":true},"master":{"description":"Enable master role.","type":"boolean","default":true},"ml":{"description":"Enable machine learning role.","type":"boolean","default":false}}},"replicas":{"description":"Number of Elasticsearch nodes in the cluster.","type":"integer","default":3},"resources":{"description":"Explicit CPU and memory configuration for each Elasticsearch node. When omitted, the preset defined in `resourcesPreset` is applied.","type":"object","default":{},"properties":{"cpu":{"description":"CPU available to each node.","pattern":"^(\\+|-)?(([0-9]+(\\.[0-9]*)?)|(\\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\\+|-)?(([0-9]+(\\.[0-9]*)?)|(\\.[0-9]+))))?$","anyOf":[{"type":"integer"},{"type":"string"}],"x-kubernetes-int-or-string":true},"memory":{"description":"Memory (RAM) available to each node.","pattern":"^(\\+|-)?(([0-9]+(\\.[0-9]*)?)|(\\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\\+|-)?(([0-9]+(\\.[0-9]*)?)|(\\.[0-9]+))))?$","anyOf":[{"type":"integer"},{"type":"string"}],"x-kubernetes-int-or-string":true}}},"resourcesPreset":{"description":"Default sizing preset used when `resources` is omitted. Elasticsearch requires minimum 2Gi memory.","type":"string","default":"large","enum":["nano","micro","small","medium","large","xlarge","2xlarge"]},"size":{"description":"Persistent Volume Claim size available for application data.","default":"10Gi","pattern":"^(\\+|-)?(([0-9]+(\\.[0-9]*)?)|(\\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\\+|-)?(([0-9]+(\\.[0-9]*)?)|(\\.[0-9]+))))?$","anyOf":[{"type":"integer"},{"type":"string"}],"x-kubernetes-int-or-string":true},"storageClass":{"description":"StorageClass used to store the data.","type":"string","default":""},"topologySpreadPolicy":{"description":"How strictly to enforce pod distribution across nodes and zones.","type":"string","default":"soft","enum":["soft","hard"]},"users":{"description":"Custom Elasticsearch users configuration map.","type":"object","default":{},"additionalProperties":{"type":"object","properties":{"password":{"description":"Password for the user (auto-generated if omitted).","type":"string"},"roles":{"description":"List of Elasticsearch roles.","type":"array","items":{"type":"string"}}}}},"version":{"description":"Elasticsearch major version to deploy.","type":"string","default":"v9","enum":["v9","v8","v7"]}}}
  release:
    prefix: elasticsearch-
    labels:
      sharding.fluxcd.io/key: tenants
    chartRef:
      kind: ExternalArtifact
      name: cozystack-elasticsearch-application-default-elasticsearch
      namespace: cozy-system
  dashboard:
    category: PaaS
    singular: Elasticsearch
    plural: Elasticsearch Clusters
    description: Managed Elasticsearch service
    tags:
      - database
      - search
    icon: PHN2ZyB3aWR0aD0iMTQ0IiBoZWlnaHQ9IjE0NCIgdmlld0JveD0iMCAwIDE0NCAxNDQiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxNDQiIGhlaWdodD0iMTQ0IiByeD0iMjQiIGZpbGw9InVybCgjcGFpbnQwX2xpbmVhcl9lbGFzdGljc2VhcmNoKSIvPgo8cGF0aCBkPSJNMjQgNzJDMjQgNzIgMzYgNDggNzIgNDhDMTA4IDQ4IDEyMCA3MiAxMjAgNzJDMTIwIDcyIDEwOCA5NiA3MiA5NkMzNiA5NiAyNCA3MiAyNCA3MloiIGZpbGw9IiNGRUM1MTQiLz4KPHBhdGggZD0iTTcyIDQ4QzEwOCA0OCAxMjAgNzIgMTIwIDcyQzEyMCA3MiAxMDggOTYgNzIgOTYiIHN0cm9rZT0iIzM0Mzc0MSIgc3Ryb2tlLXdpZHRoPSI0IiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz4KPHBhdGggZD0iTTcyIDQ4QzM2IDQ4IDI0IDcyIDI0IDcyQzI0IDcyIDM2IDk2IDcyIDk2IiBzdHJva2U9IiMwMEJGQjMiIHN0cm9rZS13aWR0aD0iNCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+CjxjaXJjbGUgY3g9IjcyIiBjeT0iNzIiIHI9IjE2IiBmaWxsPSIjMzQzNzQxIi8+CjxjaXJjbGUgY3g9IjcyIiBjeT0iNzIiIHI9IjgiIGZpbGw9IiMwMEJGQjMiLz4KPGRlZnM+CjxsaW5lYXJHcmFkaWVudCBpZD0icGFpbnQwX2xpbmVhcl9lbGFzdGljc2VhcmNoIiB4MT0iMTQwIiB5MT0iMTMwLjUiIHgyPSI0IiB5Mj0iOS40OTk5OSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPgo8c3RvcCBzdG9wLWNvbG9yPSIjMUIxRjIzIi8+CjxzdG9wIG9mZnNldD0iMSIgc3RvcC1jb2xvcj0iIzM0Mzc0MSIvPgo8L2xpbmVhckdyYWRpZW50Pgo8L2RlZnM+Cjwvc3ZnPgo=
    keysOrder: [["apiVersion"], ["appVersion"], ["kind"], ["metadata"], ["metadata", "name"], ["spec", "replicas"], ["spec", "resources"], ["spec", "resourcesPreset"], ["spec", "size"], ["spec", "storageClass"], ["spec", "external"], ["spec", "topologySpreadPolicy"], ["spec", "version"], ["spec", "images"], ["spec", "images", "elasticsearch"], ["spec", "nodeRoles"], ["spec", "nodeRoles", "master"], ["spec", "nodeRoles", "data"], ["spec", "nodeRoles", "ingest"], ["spec", "nodeRoles", "ml"], ["spec", "users"], ["spec", "kibana"], ["spec", "kibana", "enabled"], ["spec", "kibana", "replicas"], ["spec", "kibana", "resources"], ["spec", "kibana", "resourcesPreset"]]
  secrets:
    exclude: []
    include:
      - resourceNames:
          - elasticsearch-{{ .name }}-credentials
  services:
    exclude: []
    include:
      - resourceNames:
          - elasticsearch-{{ .name }}-es-http
          - elasticsearch-{{ .name }}-external
          - elasticsearch-{{ .name }}-kb-http
          - elasticsearch-{{ .name }}-kibana-external
