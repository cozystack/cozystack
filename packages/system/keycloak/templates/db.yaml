apiVersion: postgresql.cnpg.io/v1
kind: Cluster
metadata:
  name: keycloak-db
spec:
  instances: 2
  storage:
    size: 20Gi
  {{- $cozystack := .Values.cozystack | default dict }}
  {{- $scheduling := $cozystack.scheduling | default dict }}
  {{- $topologySpreadConstraints := $scheduling.topologySpreadConstraints | default list }}
  {{- if $topologySpreadConstraints }}
  topologySpreadConstraints:
    {{- range $topologySpreadConstraints }}
    - {{ . | toYaml | nindent 6 | trim }}
    {{- end }}
    labelSelector:
      matchLabels:
        cnpg.io/cluster: keycloak-db
  {{- end }}
  monitoring:
    enablePodMonitor: true

  inheritedMetadata:
    labels:
      policy.cozystack.io/allow-to-apiserver: "true"
