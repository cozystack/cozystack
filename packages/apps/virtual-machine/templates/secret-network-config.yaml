# if subnets are specified and image is either ubunu or alpine
{{- if and .Values.subnets (or (eq .Values.systemDisk.image "ubuntu") (eq .Values.systemDisk.image "alpine")) }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "virtual-machine.fullname" $ }}-network-config
stringData:
  networkData: |
    network:
      version: 1
      config:
      {{- if eq .Values.systemDisk.image "ubuntu" }}
      # main iface
      - type: physical
        name: enp1s0
        subnets:
          - type: dhcp
      # additional ifaces attached to subnets
      {{- range $i, $subnet := .Values.subnets }}
      - type: physical
        name: enp{{ add 2 $i }}s0
        subnets:
          - type: dhcp
      {{- end }}
      {{- else if eq .Values.systemDisk.image "alpine" }}
      #main iface
      - type: physical
        name: eth0
        subnets:
          - type: dhcp
      # additional ifaces attached to subnets
      {{- range $i, $subnet := .Values.subnets }}
      - type: physical
        name: eth{{ add1 $i }}
        subnets:
          - type: dhcp
      {{- end }}
      {{- end }}
{{- end }}
