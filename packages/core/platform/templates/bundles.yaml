{{- $systemBundleType := .Values.bundles.system.type | default "full" }}

{{- /* ====================================================================== */}}
{{- /* System Bundle Deployment                                              */}}
{{- /* ====================================================================== */}}

{{- if eq $systemBundleType "minimal" }}
{{    include "cozystack.render-file" (list . "bundles/system/bundle-minimal.yaml") }}
{{- else if eq $systemBundleType "full" }}
{{    include "cozystack.render-file" (list . "bundles/system/bundle-full.yaml") }}
{{- else if eq $systemBundleType "hosted" }}
{{    include "cozystack.render-file" (list . "bundles/system/bundle-hosted.yaml") }}
{{- else }}
{{-   fail (printf "ERROR: unknown system bundle type '%s'. Supported values: 'minimal', 'full', 'hosted'" $systemBundleType) }}
{{- end }}

{{- /* IaaS bundle: only available with system type "full" */}}
{{- if .Values.bundles.iaas.enabled }}
{{-   if ne $systemBundleType "full" }}
{{-     fail "ERROR: iaas bundle can only be used with system bundle type 'full'" }}
{{-   end }}
{{    include "cozystack.render-file" (list . "bundles/iaas/bundle.yaml") }}
{{- end }}

{{- /* PaaS bundle: only available with system type "full" or "hosted" */}}
{{- if .Values.bundles.paas.enabled }}
{{-   if and (ne $systemBundleType "full") (ne $systemBundleType "hosted") }}
{{-     fail "ERROR: paas bundle can only be used with system bundle type 'full' or 'hosted'" }}
{{- end }}
{{    include "cozystack.render-file" (list . "bundles/paas/bundle.yaml") }}
{{- end }}

{{- /* NaaS bundle: only available with system type "full" or "hosted" */}}
{{- if .Values.bundles.naas.enabled }}
{{-   if and (ne $systemBundleType "full") (ne $systemBundleType "hosted") }}
{{-     fail "ERROR: naas bundle can only be used with system bundle type 'full' or 'hosted'" }}
{{-   end }}
{{    include "cozystack.render-file" (list . "bundles/naas/bundle.yaml") }}
{{- end }}

