---
apiVersion: source.toolkit.fluxcd.io/v1
kind: GitRepository
metadata:
  name: cozystack
  namespace: cozy-system
spec:
  interval: 1m0s
  ref:
    tag: v0.37.6
  timeout: 60s
  url: https://github.com/cozystack/cozystack.git
  ignore: |
    # exclude all
    /*
    # include packages dir
    !/packages

---
apiVersion: source.extensions.fluxcd.io/v1beta1
kind: ArtifactGenerator
metadata:
  name: system
  namespace: cozy-system
spec:
  sources:
    - alias: cozystack
      kind: GitRepository
      name: cozystack
      namespace: cozy-system
  artifacts:
    - name: system-cilium
      copy:
        - from: "@cozystack/packages/system/cilium/**"
          to: "@artifact/cilium/"
    - name: system-kubeovn
      copy:
        - from: "@cozystack/packages/system/kubeovn/**"
          to: "@artifact/kubeovn/"

---
apiVersion: source.extensions.fluxcd.io/v1beta1
kind: ArtifactGenerator
metadata:
  name: apps
  namespace: cozy-public
spec:
  sources:
    - alias: cozystack
      kind: GitRepository
      name: cozystack
      namespace: cozy-system
  artifacts:
    - name: apps-virtual-machine
      copy:
        - from: "@cozystack/packages/apps/virtual-machine/**"
          to: "@artifact/virtual-machine/"
        - from: "@cozystack/packages/library/cozy-lib/**"
          to: "@artifact/virtual-machine/charts/cozy-lib/"
    - name: apps-vm-instance
      copy:
        - from: "@cozystack/packages/apps/vm-instance/**"
          to: "@artifact/vm-instance/"
        - from: "@cozystack/packages/library/cozy-lib/**"
          to: "@artifact/vm-instance/charts/cozy-lib/"

---
apiVersion: source.extensions.fluxcd.io/v1beta1
kind: ArtifactGenerator
metadata:
  name: extra
  namespace: cozy-public
spec:
  sources:
    - alias: cozystack
      kind: GitRepository
      name: cozystack
      namespace: cozy-system
  artifacts:
    - name: extra-etcd
      copy:
        - from: "@cozystack/packages/extra/etcd/**"
          to: "@artifact/extra/"
        - from: "@cozystack/packages/library/cozy-lib/**"
          to: "@artifact/extra/charts/cozy-lib/"
    - name: extra-seaweedfs
      copy:
        - from: "@cozystack/packages/extra/seaweedfs/**"
          to: "@artifact/seaweedfs/"
        - from: "@cozystack/packages/library/cozy-lib/**"
          to: "@artifact/seaweedfs/charts/cozy-lib/"

