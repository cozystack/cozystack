---
apiVersion: source.toolkit.fluxcd.io/v1
kind: OCIRepository
metadata:
  name: cozystack-packages
  namespace: cozy-system
spec:
  interval: 5m0s
  url: oci://ghcr.io/cozystack/cozystack/platform-packages
  ref:
    digest: sha256:ca54e8ef2073ed387aaf74fed4156cee365a7925c3c51174ff5115c95a1b9179
    #tag: latest
---
apiVersion: source.extensions.fluxcd.io/v1beta1
kind: ArtifactGenerator
metadata:
  name: cozystack-packages
  namespace: cozy-system
spec:
  artifacts:
  - copy:
    - from: '@cozystack/core/platform/**'
      to: '@artifact/platform/'
    name: cozystack-core-platform
  sources:
  - alias: cozystack
    kind: OCIRepository
    name: cozystack-packages
    namespace: cozy-system
---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: cozystack-platform
  namespace: cozy-system
spec:
  interval: 5m
  targetNamespace: cozy-system
  releaseName: cozystack-platform
  chartRef:
    kind: ExternalArtifact
    name: cozystack-core-platform
    namespace: cozy-system
  values:
    sourceRef:
      kind: OCIRepository
      name: cozystack-packages
      namespace: cozy-system
