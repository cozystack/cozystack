---
apiVersion: cozystack.io/v1alpha1
kind: PackageSource
metadata:
  name: cozystack.networking
spec:
  sourceRef:
    kind: OCIRepository
    name: cozystack-packages
    namespace: cozy-system
    path: /
  variants:
  - name: noop
    components: []
  - name: cilium
    dependsOn:
    - cozystack.cert-manager
    components:
    - name: cilium
      path: system/cilium
      valuesFiles:
      - values.yaml
      - values-talos.yaml
      install:
        privileged: true
        namespace: cozy-cilium
        releaseName: cilium
        dependsOn: []
    - name: cilium-networkpolicy
      path: system/cilium-networkpolicy
      install:
        privileged: true
        namespace: cozy-cilium
        releaseName: cilium-networkpolicy
        dependsOn:
        - cilium
  - name: kubeovn-cilium
    dependsOn:
    - cozystack.cert-manager
    components:
    - name: cilium
      path: system/cilium
      valuesFiles:
      - values.yaml
      - values-talos.yaml
      - values-kubeovn.yaml
      install:
        privileged: true
        namespace: cozy-cilium
        releaseName: cilium
        dependsOn: []
    - name: cilium-networkpolicy
      path: system/cilium-networkpolicy
      install:
        privileged: true
        namespace: cozy-cilium
        releaseName: cilium-networkpolicy
        dependsOn:
        - cilium
    - name: kubeovn
      path: system/kubeovn
      install:
        privileged: true
        namespace: cozy-kubeovn
        releaseName: kubeovn
        dependsOn:
        - cilium
    - name: kubeovn-plunger
      path: system/kubeovn-plunger
      install:
        namespace: cozy-kubeovn
        releaseName: kubeovn-plunger
        dependsOn:
        - cilium
        - kubeovn
    - name: kubeovn-webhook
      path: system/kubeovn-webhook
      install:
        privileged: true
        namespace: cozy-kubeovn
        releaseName: kubeovn-webhook
        dependsOn:
        - cilium
        - kubeovn
